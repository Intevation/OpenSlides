<div class="jitsi-integration">
    <div
        class="minimized"
        [ngClass]="{
            'cdk-visually-hidden': !enableJitsi
        }"
    >
        <span class="control-icon-wrapper apply-theme">
            <!-- mute/unmute button -->
            <button class="quick-icon" mat-mini-fab [disabled]="!isJoined" (click)="toggleMute()">
                <mat-icon color="{{ muted ? 'primary' : 'warn' }}">{{ muted ? 'moff' : 'mic' }}</mat-icon>
            </button>

            <!-- hide unhide video -->
            <!-- <button class="quick-icon" mat-mini-fab [disabled]="!isJoined">
            <mat-icon *ngIf="isJoined" color="primary">videocam_off</mat-icon>
            </button> -->
        </span>

        <span class="list-wrapper apply-theme regular-shadow">
            <!-- open-window button -->
            <button class="toggle-list-button" mat-button (click)="toggleShowJitsi()">
                <span> {{ 'Audio Conference' | translate }}</span>
                <mat-icon *ngIf="!showJitsiWindow">keyboard_arrow_up</mat-icon>
                <mat-icon *ngIf="showJitsiWindow">keyboard_arrow_down </mat-icon>

                <div *ngIf="currentDominantSpeaker">
                    <os-icon-container [noWrap]="true" icon="mic">
                        <b> {{ currentDominantSpeaker.displayName }} </b>
                    </os-icon-container>
                </div>
            </button>

            <!-- unfolded list -->
            <div
                class="jitsi-list"
                [ngClass]="{
                    'cdk-visually-hidden': !showJitsiWindow
                }"
            >
                <!-- Jitsi content window -->
                <div class="content">
                    <!-- The "somewhere else active" warning -->
                    <div class="disconnected" *ngIf="isJitsiActiveInAnotherTab && !isJitsiActive">
                        <span>{{ 'Another instance of Jitsi is active in you OpenSlides session' | translate }}</span>
                        <button mat-button color="warn" (click)="forceStart()">
                            <span>{{ 'Force Jitsi to reload' | translate }}</span>
                        </button>
                    </div>

                    <div class="disconnected" *ngIf="!isJitsiActiveInAnotherTab && !isJitsiActive">
                        <span>{{ 'disconnected' | translate }}</span>
                    </div>

                    <!-- Hidden jitsy container -->
                    <div [ngStyle]="{ display: 'none' }" #jitsi></div>

                    <!-- user list -->
                    <div class="room-members" *ngIf="isJitsiActive">
                        <div class="member-list">
                            <ol>
                                <li
                                    *ngFor="let memberId of memberList; trackBy: trackByIndex"
                                    [ngClass]="{
                                        focused: members[memberId].focus
                                    }"
                                >
                                    <div class="member-list-entry">
                                        {{ members[memberId].name }}
                                    </div>
                                </li>
                            </ol>
                            <button mat-button class="open-jitsi-in-tab" color="accent" (click)="openExternal()">
                                <span>{{ 'Open Jitsi in new tab' | translate }}</span>
                                <mat-icon>
                                    open_in_new
                                </mat-icon>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Custom control buttons -->
                <div class="control-buttons">
                    <mat-divider></mat-divider>
                    <div *ngIf="isJitsiActive && isJoined" class="active-buttons">
                        <button mat-mini-fab color="warn" (click)="stopJitsi()" matTooltip="{{ 'Leave' | translate }}">
                            <mat-icon>call_end</mat-icon>
                        </button>
                    </div>

                    <div *ngIf="!isJoined" class="active-buttons">
                        <!-- Enter jitsi manually -->
                        <button
                            mat-mini-fab
                            color="accent"
                            (click)="enterConversation()"
                            [disabled]="isJitsiActive || isJitsiActiveInAnotherTab"
                            matTooltip="{{ 'Enter conference' | translate }}"
                        >
                            <mat-icon>call</mat-icon>
                        </button>
                    </div>
                </div>
            </div>
        </span>
    </div>
</div>
